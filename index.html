<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–í—ã—Ä–∞—Å—Ç–∏ —Å–∞–¥</title>
<style>
:root{--bg:#eef6ef;--card:#fff;--accent:#4caf50;--muted:#6b7280;--warn:#f87171}
body{margin:0;font-family:sans-serif;background:var(--bg);display:flex;justify-content:center;padding:20px}
.wrap{max-width:900px;width:100%}
header{display:flex;justify-content:flex-end;flex-wrap:wrap;gap:8px;margin-bottom:16px}
.garden{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;position:relative}
.bed{background:linear-gradient(180deg,#f0fff0,#d6ffe0);padding:12px;border-radius:16px;min-height:120px;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative;border:1px solid rgba(34,197,94,0.2);transition:0.3s;box-shadow:0 4px 8px rgba(0,0,0,0.08);}
.bed.selected{outline:3px solid rgba(74,222,128,0.4);box-shadow:0 10px 30px rgba(74,222,128,0.15)}
.bed .soil{width:100%;height:48px;background:linear-gradient(180deg,#8b5a2b,#6b3f1f);border-radius:12px;margin-top:10px;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;transition:0.3s}
.bed .plant{position:absolute;top:14px;display:flex;flex-direction:column;align-items:center;gap:6px;transition:0.3s}
.bed .plant .emoji{font-size:32px;transition:transform 0.5s;}
.bed .plant .leaves{display:block;transition:transform 0.5s;transform-origin:bottom center;}
.bed .plant .stage{font-size:12px;color:#111;font-weight:600}
.bed .plant .progress{width:80px;height:6px;background:#e6f4ea;border-radius:999px;overflow:hidden;display:block;margin-top:4px}
.bed .plant .progress i{display:block;height:100%;background:linear-gradient(90deg,#34d399,#10b981);width:0%;transition:width 0.5s;}
.controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:16px;justify-content:center}
.btn{padding:10px 16px;border-radius:12px;border:none;cursor:pointer;box-shadow:0 6px 16px rgba(0,0,0,0.1);font-weight:600;transition:0.2s}
.btn:hover{transform:translateY(-2px);box-shadow:0 8px 20px rgba(0,0,0,0.15)}
.btn.primary{background:linear-gradient(90deg,var(--accent),#60a5fa);color:#fff}
.modal{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);background:#fff;padding:18px;border-radius:12px;display:none;box-shadow:0 10px 30px rgba(0,0,0,0.3);width:360px;z-index:10;max-height:80%;overflow:auto;}
.modal.open{display:block}
.shop-row{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px dashed #ccc}
.shop-row:last-child{border-bottom:none}
.toast{position:fixed;top:20px;left:50%;transform:translateX(-50%);background:var(--warn);color:#fff;padding:10px 16px;border-radius:10px;opacity:0;pointer-events:none;transition:0.5s;z-index:20}.toast.show{opacity:1;pointer-events:auto}
.water-drop{position:absolute;width:8px;height:12px;background:rgba(59,130,246,0.8);border-radius:50%;animation:fall 0.6s linear;pointer-events:none;}
@keyframes fall{0%{transform:translateY(0);}100%{transform:translateY(100px);opacity:0;}}
.seed-select{display:flex;gap:6px;flex-wrap:wrap;margin-top:10px;}
.seed-option{padding:6px 10px;background:#d1fae5;border-radius:8px;cursor:pointer;transition:0.2s}
.seed-option:hover{background:#34d399;color:#fff;}
</style>
</head>
<body>
<div class="wrap">
<header>
<button id="openShop" class="btn">üõí –ú–∞–≥–∞–∑–∏–Ω</button>
<button id="openInventory" class="btn">üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
<button id="openSettings" class="btn">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
</header>

<div class="garden" id="garden"></div>

<div class="controls">
<button id="plantBtn" class="btn primary">–ü–æ—Å–∞–¥–∏—Ç—å</button>
<button id="waterBtn" class="btn primary">–ü–æ–ª–∏—Ç—å</button>
<button id="harvestBtn" class="btn primary">–°–æ–±—Ä–∞—Ç—å —É—Ä–æ–∂–∞–π</button>
</div>

<!-- Seed selection modal -->
<div id="seedModal" class="modal">
<h3>–í—ã–±–µ—Ä–∏—Ç–µ —Å–µ–º—è –¥–ª—è –ø–æ—Å–∞–¥–∫–∏</h3>
<div id="seedOptions" class="seed-select"></div>
<button id="closeSeedModal" class="btn" style="margin-top:8px;">–û—Ç–º–µ–Ω–∞</button>
</div>

<div id="shop" class="modal">
<h3>–ú–∞–≥–∞–∑–∏–Ω</h3>
<div style="display:flex;gap:10px;margin-bottom:10px;">
<button id="tabShop" class="btn primary">Shop</button>
<button id="tabSell" class="btn primary">Sell</button>
</div>
<div id="shopContent"></div>
<button id="closeShop" class="btn" style="margin-top:8px;">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>

<div id="inventory" class="modal">
<h3>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h3>
<div id="inventoryList"></div>
<button id="closeInventory" class="btn" style="margin-top:8px;">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>

<div id="settings" class="modal">
<h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
<button id="resetBtn" class="btn">–°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å</button>
<button id="closeSettings" class="btn" style="margin-top:8px;">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>

<div id="toast" class="toast"></div>
</div>

<script>
const GARDEN_SIZE=8;
let garden=[], inventory=[], selectedBed=null;
let money=parseInt(localStorage.getItem('money'))||20;
let water=parseInt(localStorage.getItem('water'))||2;

const plantsData = {
  '–ú–æ—Ä–∫–æ–≤—å': {growRate:5, price:10, maxHarvest:1, cost:5},
  '–ö–ª—É–±–Ω–∏–∫–∞': {growRate:2, price:5, maxHarvest:10, cost:10}
};

const gardenEl=document.getElementById('garden');
const toastEl=document.getElementById('toast');
const inventoryListEl=document.getElementById('inventoryList');
const seedModal=document.getElementById('seedModal');
const seedOptions=document.getElementById('seedOptions');

function showToast(msg){
  toastEl.textContent=msg;
  toastEl.classList.add('show');
  setTimeout(()=>{toastEl.classList.remove('show');},2000);
}

function saveProgress(){
  localStorage.setItem('money',money);
  localStorage.setItem('water',water);
  localStorage.setItem('garden',JSON.stringify(garden.map(b=>b.plant)));
  localStorage.setItem('inventory',JSON.stringify(inventory));
}

function updateUI(){
  garden.forEach((b,i)=>{
    const el=document.getElementById('bed-'+i);
    el.classList.toggle('selected',selectedBed===i);
    const plantEl=el.querySelector('.plant');
    const soilEl=el.querySelector('.soil');
    if(!b.plant){
      if(plantEl) plantEl.remove();
      soilEl.textContent='–ü—É—Å—Ç–æ';
    } else {
      soilEl.textContent='';
      if(!plantEl){
        const div=document.createElement('div');
        div.className='plant';
        div.innerHTML=`<div class="leaves">üåø</div><div class="emoji">${b.plant.type==='–ú–æ—Ä–∫–æ–≤—å'?'ü•ï':'üçì'}</div>
        <div class="stage">${b.plant.progress||0}%</div>
        <div class="progress"><i style="width:${b.plant.progress||0}%"></i></div>`;
        el.appendChild(div);
      } else {
        plantEl.querySelector('.progress i').style.width=(b.plant.progress||0)+'%';
        plantEl.querySelector('.stage').textContent=Math.floor(b.plant.progress||0)+'%';
        const leaves=el.querySelector('.leaves');
        if(leaves) leaves.style.transform=`translateY(${-(b.plant.progress/5)}px) rotate(${Math.sin(Date.now()/500)*10}deg)`;
        const scale=0.5+0.5*(b.plant.progress/100);
        el.querySelector('.plant .emoji').style.transform=`scale(${scale})`;
      }
    }
  });
  renderInventory();
  saveProgress();
}

function renderInventory(){
  const counts={};
  inventory.forEach(item=>counts[item.type]=counts[item.type]?counts[item.type]+1:1);
  let html='';
  for(const key in counts){
    html+=`${key} x ${counts[key]}<br>`;
  }
  inventoryListEl.innerHTML=html||'–ü—É—Å—Ç–æ';
}

function createBeds(){
  garden=[];
  const savedGarden=JSON.parse(localStorage.getItem('garden')||'[]');
  const savedInventory=JSON.parse(localStorage.getItem('inventory')||'[]');
  inventory=[];
  savedInventory.forEach(i=>inventory.push(i));

  for(let i=0;i<GARDEN_SIZE;i++){
    const bed={plant:savedGarden[i]||null};
    garden.push(bed);
    const div=document.createElement('div');
    div.className='bed';
    div.id='bed-'+i;
    div.innerHTML='<div class="soil">–ü—É—Å—Ç–æ</div>';
    div.addEventListener('click',()=>{selectedBed=i;updateUI();});
    gardenEl.appendChild(div);
  }
}

function plantSeed(){
  if(selectedBed===null){showToast('–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—è–¥–∫—É');return;}
  const b=garden[selectedBed];
  if(b.plant){showToast('–ì—Ä—è–¥–∫–∞ –∑–∞–Ω—è—Ç–∞');return;}
  const seedTypes = [...new Set(inventory.map(i=>i.type))];
  if(seedTypes.length===0){showToast('–ù–µ—Ç —Å–µ–º—è–Ω');return;}
  if(seedTypes.length===1){
    plantChosen(seedTypes[0]);
  } else {
    seedOptions.innerHTML='';
    seedTypes.forEach(type=>{
      const btn=document.createElement('div');
      btn.className='seed-option';
      btn.textContent=type;
      btn.addEventListener('click',()=>plantChosen(type));
      seedOptions.appendChild(btn);
    });
    seedModal.classList.add('open');
  }
}

function plantChosen(type){
  const idx=inventory.findIndex(i=>i.type===type);
  if(idx!==-1){
    inventory.splice(idx,1);
    garden[selectedBed].plant={type,type:type,maxHarvest:plantsData[type].maxHarvest,harvested:0,progress:0};
    updateUI();
    seedModal.classList.remove('open');
  }
}

function waterBed(){
  if(selectedBed===null){showToast('–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—è–¥–∫—É');return;}
  const b=garden[selectedBed];
  if(!b.plant){showToast('–ù–µ—Ç —Ä–∞—Å—Ç–µ–Ω–∏—è');return;}
  if(water<=0){showToast('–í–æ–¥—ã –Ω–µ—Ç');return;}
  water--;
  b.plant.progress=Math.min(100,(b.plant.progress||0)+20);
  createWaterDrops(document.getElementById('bed-'+selectedBed));
  updateUI();
}

function createWaterDrops(bedEl){
  if(!bedEl) return;
  for(let i=0;i<5;i++){
    const drop=document.createElement('div');
    drop.className='water-drop';
    drop.style.left=(10+Math.random()*60)+'px';
    drop.style.animationDelay=(i*0.1)+'s';
    bedEl.appendChild(drop);
    setTimeout(()=>{drop.remove();},600);
  }
}

function harvestSelected(){
  if(selectedBed===null){showToast('–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—è–¥–∫—É');return;}
  const b=garden[selectedBed];
  if(!b.plant){showToast('–ì—Ä—è–¥–∫–∞ –ø—É—Å—Ç–∞');return;}
  if(b.plant.harvested< b.plant.maxHarvest){
    inventory.push({type:b.plant.type});
    b.plant.harvested++;
    if(b.plant.harvested>=b.plant.maxHarvest) b.plant=null;
    updateUI();
  } else {
    b.plant=null;
    updateUI();
  }
}

// –ê–≤—Ç–æ-—Ä–æ—Å—Ç
setInterval(()=>{
  garden.forEach(b=>{
    if(b.plant && b.plant.progress<100){
      b.plant.progress=Math.min(100,(b.plant.progress||0)+plantsData[b.plant.type].growRate);
    }
  });
  updateUI();
},1000);

createBeds();
updateUI();

// Buttons
document.getElementById('plantBtn').addEventListener('click',plantSeed);
document.getElementById('waterBtn').addEventListener('click',()=>{waterBed();});
document.getElementById('harvestBtn').addEventListener('click',harvestSelected);

// Seed modal
document.getElementById('closeSeedModal').addEventListener('click',()=>{seedModal.classList.remove('open');});

// Shop
const shop=document.getElementById('shop');
const shopContent=document.getElementById('shopContent');
const tabShop=document.getElementById('tabShop');
const tabSell=document.getElementById('tabSell');

function renderShop(){
  shopContent.innerHTML='';
  for(const key in plantsData){
    const btn=document.createElement('button');
    btn.className='btn';
    btn.textContent=`–ö—É–ø–∏—Ç—å 1 ${key} (${plantsData[key].cost}üí∞)`;
    btn.addEventListener('click',()=>{
      if(money<plantsData[key].cost){showToast('–ù–µ—Ç –¥–µ–Ω–µ–≥');return;}
      money-=plantsData[key].cost;
      inventory.push({type:key});
      updateUI();
    });
    const div=document.createElement('div');
    div.className='shop-row';
    div.textContent=key;
    div.appendChild(btn);
    shopContent.appendChild(div);
  }
}

function renderSell(){
  shopContent.innerHTML='';
  const types=[...new Set(inventory.map(i=>i.type))];
  types.forEach(type=>{
    const btn=document.createElement('button');
    btn.className='btn';
    btn.textContent='–ü—Ä–æ–¥–∞—Ç—å 1';
    btn.addEventListener('click',()=>{
      const idx=inventory.findIndex(i=>i.type===type);
      if(idx!==-1){
        inventory.splice(idx,1);
        money+=plantsData[type].price;
        updateUI();
      } else showToast('–ù–µ—Ç –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ');
    });
    const div=document.createElement('div');
    div.className='shop-row';
    div.textContent=type;
    div.appendChild(btn);
    shopContent.appendChild(div);
  });
}

renderShop();
tabShop.addEventListener('click',renderShop);
tabSell.addEventListener('click',renderSell);
document.getElementById('openShop').addEventListener('click',()=>{shop.classList.add('open');});
document.getElementById('closeShop').addEventListener('click',()=>{shop.classList.remove('open');});

// Inventory
const inventoryModal=document.getElementById('inventory');
document.getElementById('openInventory').addEventListener('click',()=>{inventoryModal.classList.add('open');});
document.getElementById('closeInventory').addEventListener('click',()=>{inventoryModal.classList.remove('open');});

// Settings
const settings=document.getElementById('settings');
document.getElementById('openSettings').addEventListener('click',()=>{settings.classList.add('open');});
document.getElementById('closeSettings').addEventListener('click',()=>{settings.classList.remove('open');});
document.getElementById('resetBtn').addEventListener('click',()=>{if(confirm('–í—ã —Ç–æ—á–Ω–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å?')){localStorage.clear();location.reload();}});
</script>
</body>
</html>
