<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ò–≥—Ä–∞: –í—ã—Ä–∞—Å—Ç–∏ —Å–∞–¥</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #e0ffe0;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    header {
      background: #4caf50;
      color: white;
      padding: 10px;
      width: 100%;
      text-align: center;
      font-size: 24px;
      font-weight: bold;
    }
    #stats {
      margin: 10px;
      font-size: 16px;
    }
    #garden {
      display: grid;
      grid-template-columns: repeat(4, 120px);
      grid-gap: 10px;
      margin: 20px;
    }
    .bed {
      width: 120px;
      height: 120px;
      border: 2px solid #555;
      border-radius: 8px;
      background: #a0522d;
      position: relative;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: flex-end;
      cursor: pointer;
    }
    .plant {
      position: absolute;
      bottom: 5px;
      transition: transform 1s linear;
    }
    .growth-bar {
      position: absolute;
      bottom: 0;
      left: 0;
      height: 6px;
      background: limegreen;
      width: 0%;
      transition: width 0.5s;
    }
    #controls {
      margin: 20px;
      display: flex;
      gap: 10px;
    }
    button {
      padding: 8px 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }
    .water-btn { background: #2196f3; color: white; }
    .plant-btn { background: #4caf50; color: white; }
    .harvest-btn { background: #ff9800; color: white; }
    .shop-btn { background: #9c27b0; color: white; }
    .inv-btn { background: #607d8b; color: white; }
    .settings-btn { background: #f44336; color: white; }
    #toast {
      position: fixed;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 10px 20px;
      border-radius: 5px;
      display: none;
      z-index: 1000;
    }
    /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.6);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }
    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 10px;
      max-width: 400px;
      max-height: 80%;
      overflow-y: auto;
    }
    .modal h2 {
      margin-top: 0;
    }
    .close {
      float: right;
      cursor: pointer;
      color: red;
    }
  </style>
</head>
<body>
  <header>üå± –ò–≥—Ä–∞: –í—ã—Ä–∞—Å—Ç–∏ —Å–∞–¥</header>
  <div id="stats">
    üí∞ –î–µ–Ω—å–≥–∏: <span id="money">0</span> |
    üíß –í–æ–¥–∞: <span id="water">0</span>
  </div>

  <div id="garden"></div>

  <div id="controls">
    <button class="water-btn" onclick="waterPlant()">–ü–æ–ª–∏—Ç—å</button>
    <button class="plant-btn" onclick="openPlantMenu()">–ü–æ—Å–∞–¥–∏—Ç—å</button>
    <button class="harvest-btn" onclick="harvestPlant()">–°–æ–±—Ä–∞—Ç—å</button>
    <button class="shop-btn" onclick="openShop()">–ú–∞–≥–∞–∑–∏–Ω</button>
    <button class="inv-btn" onclick="openInventory()">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
    <button class="settings-btn" onclick="openSettings()">‚öôÔ∏è</button>
  </div>

  <div id="toast"></div>

  <!-- –ú–∞–≥–∞–∑–∏–Ω -->
  <div id="shopModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeShop()">&times;</span>
      <h2>–ú–∞–≥–∞–∑–∏–Ω</h2>
      <button onclick="buySeed('–ú–æ—Ä–∫–æ–≤—å')">–ö—É–ø–∏—Ç—å —Å–µ–º–µ–Ω–∞ –º–æ—Ä–∫–æ–≤–∏ (5üí∞)</button><br>
      <button onclick="buySeed('–ö–ª—É–±–Ω–∏–∫–∞')">–ö—É–ø–∏—Ç—å —Å–µ–º–µ–Ω–∞ –∫–ª—É–±–Ω–∏–∫–∏ (10üí∞)</button><br>
      <button onclick="buySeed('–í–∏–Ω–æ–≥—Ä–∞–¥')">–ö—É–ø–∏—Ç—å —Å–µ–º–µ–Ω–∞ –≤–∏–Ω–æ–≥—Ä–∞–¥–∞ (15üí∞)</button><br>
      <button onclick="buySeed('–¢—ã–∫–≤–∞-–≤–µ–ª–∏–∫–∞–Ω')">–ö—É–ø–∏—Ç—å —Å–µ–º–µ–Ω–∞ —Ç—ã–∫–≤—ã-–≤–µ–ª–∏–∫–∞–Ω–∞ (50üí∞)</button><br>
      <button onclick="buyWater()">–ö—É–ø–∏—Ç—å –≤–æ–¥—É (2üí∞)</button><br>
      <hr>
      <button onclick="sellAll()">–ü—Ä–æ–¥–∞—Ç—å –≤—Å—ë</button>
    </div>
  </div>

  <!-- –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å -->
  <div id="invModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeInventory()">&times;</span>
      <h2>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h2>
      <div id="inventoryList"></div>
    </div>
  </div>

  <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
  <div id="settingsModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeSettings()">&times;</span>
      <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
      <button onclick="resetGame()">–°–±—Ä–æ—Å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</button>
    </div>
  </div>

  <script>
    const gardenSize = 8;
    let garden = [];
    let money = parseInt(localStorage.getItem('money')) || 20;
    let water = parseInt(localStorage.getItem('water')) || 3;
    let inventory = JSON.parse(localStorage.getItem('inventory')) || {};

    const plants = {
      "–ú–æ—Ä–∫–æ–≤—å": {growTime: 10, pricePerKg: 5, minWeight: 1, maxWeight: 3},
      "–ö–ª—É–±–Ω–∏–∫–∞": {growTime: 15, pricePerKg: 8, minWeight: 0.5, maxWeight: 1.5, multiHarvest: 10},
      "–í–∏–Ω–æ–≥—Ä–∞–¥": {growTime: 20, pricePerKg: 6, minWeight: 2, maxWeight: 5},
      "–¢—ã–∫–≤–∞-–≤–µ–ª–∏–∫–∞–Ω": {growTime: 60, pricePerKg: 10, minWeight: 40, maxWeight: 80}
    };

    let selectedBed = null;

    function saveGame() {
      localStorage.setItem('money', money);
      localStorage.setItem('water', water);
      localStorage.setItem('inventory', JSON.stringify(inventory));
      localStorage.setItem('garden', JSON.stringify(garden));
    }

    function loadGame() {
      garden = JSON.parse(localStorage.getItem('garden')) || Array(gardenSize).fill(null).map(()=>({plant:null,growth:0}));
    }

    function updateUI() {
      document.getElementById('money').textContent = money;
      document.getElementById('water').textContent = water;
      const gardenDiv = document.getElementById('garden');
      gardenDiv.innerHTML = "";
      garden.forEach((bed,i)=>{
        const bedDiv=document.createElement('div');
        bedDiv.className='bed';
        bedDiv.onclick=()=>{selectedBed=i; showToast("–í—ã–±—Ä–∞–Ω–∞ –≥—Ä—è–¥–∫–∞ "+(i+1));};
        if(bed.plant){
          const bar=document.createElement('div');
          bar.className='growth-bar';
          bar.style.width=bed.growth+"%";
          bedDiv.appendChild(bar);
          const plantEl=document.createElement('div');
          plantEl.className='plant';
          plantEl.textContent=bed.plant;
          plantEl.style.transform="scale("+(0.5+bed.growth/100)+")";
          bedDiv.appendChild(plantEl);
        } else {
          bedDiv.textContent="–ü—É—Å—Ç–æ";
        }
        gardenDiv.appendChild(bedDiv);
      });
      saveGame();
    }

    function showToast(msg){
      const t=document.getElementById('toast');
      t.textContent=msg;
      t.style.display='block';
      setTimeout(()=>{t.style.display='none';},2000);
    }

    function waterPlant(){
      if(selectedBed===null) return showToast("–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—è–¥–∫—É!");
      if(water<=0) return showToast("–ù–µ—Ç –≤–æ–¥—ã!");
      if(!garden[selectedBed].plant) return showToast("–ù–µ—á–µ–≥–æ –ø–æ–ª–∏–≤–∞—Ç—å!");
      water--;
      garden[selectedBed].growth+=20;
      if(garden[selectedBed].growth>100) garden[selectedBed].growth=100;
      updateUI();
    }

    function openPlantMenu(){
      if(selectedBed===null) return showToast("–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—è–¥–∫—É!");
      let seeds=Object.keys(inventory).filter(k=>inventory[k].seeds>0);
      if(seeds.length===0) return showToast("–ù–µ—Ç —Å–µ–º—è–Ω!");
      let choice=prompt("–ß—Ç–æ –ø–æ—Å–∞–¥–∏—Ç—å? –î–æ—Å—Ç—É–ø–Ω–æ: "+seeds.join(", "));
      if(choice && plants[choice]){
        if(inventory[choice].seeds<=0) return showToast("–ù–µ—Ç —Å–µ–º—è–Ω "+choice);
        garden[selectedBed]={plant:choice,growth:0};
        inventory[choice].seeds--;
        updateUI();
      }
    }

    function harvestPlant(){
      if(selectedBed===null) return showToast("–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—è–¥–∫—É!");
      let bed=garden[selectedBed];
      if(!bed.plant) return showToast("–¢—É—Ç –Ω–∏—á–µ–≥–æ –Ω–µ—Ç");
      if(bed.growth<100) return showToast("–†–∞—Å—Ç–µ–Ω–∏–µ –µ—â—ë –Ω–µ —Å–æ–∑—Ä–µ–ª–æ");
      const plant=plants[bed.plant];
      let weight=+(plant.minWeight+Math.random()*(plant.maxWeight-plant.minWeight)).toFixed(1);
      let roll=Math.random();
      if(roll<0.01){weight*=3; showToast("–ù–µ–≤–µ—Ä–æ—è—Ç–Ω—ã–π —É—Ä–æ–∂–∞–π!");}
      else if(roll<0.06){weight*=2; showToast("–ë–æ–ª—å—à–æ–π —É—Ä–æ–∂–∞–π!");}
      if(!inventory[bed.plant]) inventory[bed.plant]={seeds:0,harvest:0,weight:0};
      inventory[bed.plant].harvest++;
      inventory[bed.plant].weight+=weight;
      bed.plant=null; bed.growth=0;
      updateUI();
    }

    function openShop(){document.getElementById('shopModal').style.display='flex';}
    function closeShop(){document.getElementById('shopModal').style.display='none';}

    function buySeed(name){
      const prices={"–ú–æ—Ä–∫–æ–≤—å":5,"–ö–ª—É–±–Ω–∏–∫–∞":10,"–í–∏–Ω–æ–≥—Ä–∞–¥":15,"–¢—ã–∫–≤–∞-–≤–µ–ª–∏–∫–∞–Ω":50};
      if(money<prices[name]) return showToast("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥");
      money-=prices[name];
      if(!inventory[name]) inventory[name]={seeds:0,harvest:0,weight:0};
      inventory[name].seeds++;
      updateUI();
    }

    function buyWater(){
      if(money<2) return showToast("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥");
      money-=2; water++; updateUI();
    }

    function sellAll(){
      let total=0;
      for(let plant in inventory){
        if(inventory[plant].weight>0){
          let plantData=plants[plant];
          let earned=Math.round(inventory[plant].weight*plantData.pricePerKg);
          total+=earned;
          inventory[plant].harvest=0;
          inventory[plant].weight=0;
        }
      }
      money+=total;
      showToast("–ü—Ä–æ–¥–∞–Ω–æ –Ω–∞ "+total+" –º–æ–Ω–µ—Ç");
      updateUI();
    }

    function openInventory(){
      document.getElementById('invModal').style.display='flex';
      const list=document.getElementById('inventoryList');
      list.innerHTML="";
      for(let plant in inventory){
        list.innerHTML+=plant+": —Å–µ–º—è–Ω "+inventory[plant].seeds+", —É—Ä–æ–∂–∞—è "+inventory[plant].harvest+", –≤–µ—Å "+inventory[plant].weight.toFixed(1)+" –∫–≥<br>";
      }
    }
    function closeInventory(){document.getElementById('invModal').style.display='none';}

    function openSettings(){document.getElementById('settingsModal').style.display='flex';}
    function closeSettings(){document.getElementById('settingsModal').style.display='none';}
    function resetGame(){
      if(confirm("–¢–æ—á–Ω–æ —Å–±—Ä–æ—Å–∏—Ç—å?")){
        localStorage.clear();
        location.reload();
      }
    }

    function gameLoop(){
      garden.forEach(bed=>{
        if(bed.plant && bed.growth<100){
          bed.growth+=0.5;
          if(bed.growth>100) bed.growth=100;
        }
      });
      updateUI();
    }

    loadGame();
    updateUI();
    setInterval(gameLoop,1000);
  </script>
</body>
</html>
